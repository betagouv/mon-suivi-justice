<section class='new-appointment-links-container'>
  <% if current_user.admin? || current_user.bex? %>
    <%= button_tag('Liste Cabinets JAP', type: 'button',
                                         class: 'jap-agendas-modal-trigger',
                                         data: { :'micromodal-trigger' => 'jap-agendas-modal' }) %>
  <% end %>
</section>

<h1 class='form-title'><%= t('new_appointment_title') %></h1>

<%= simple_form_for @appointment do |f| %>
  <div class='new-appointment-form'>
    <% if params.has_key?(:convict_id) %>
      <%= f.input :convict_id, as: :hidden, input_html: { value: params[:convict_id] }  %>
    <% else %>
      <%= f.association :convict, collection: Convict.all,
                                  label: t('activerecord.models.convict'),
                                  as: :select,
                                  label_method: :name,
                                  input_html: { class: 'form-select', id: 'convict-name-autocomplete' } %>
    <% end %>

    <% if current_user.admin? || current_user.bex? %>
      <%= f.input :origin_department, collection: Appointment.origin_departments.keys,
                                      label_method: lambda {|k| t("simple_form.options.appointment.origin_department.#{k}")},
                                      input_html: { class: 'form-select' } %>
    <% end %>

    <%= f.association :appointment_type, collection: AppointmentType.all,
                                         label: t('activerecord.models.appointment_type'),
                                         as: :select,
                                         label_method: :name,
                                         input_html: { class: 'form-select' } %>

    <div class='appointment-form-places-container' id='places-container'></div>
    <div class='appointment-form-agendas-container' id='agendas-container'></div>
  </div>

  <div class='appointment-form-slots-container' id='slots-container'>
    <div class='new-appointment-help-container'>
      <%= t('new-appointment-help') %>
    </div>
  </div>
  </div>
  <div id='submit-btn-container'>
    <input type='submit' name='commit' value=<%= t('submit')%> class='form-submit-button new-appointment-submit-button' id='submit-new-appointment' disabled='disabled' data-disable-with='Enregistrer'>
    <p class='new-appointment-form-warning'><%= t('new-appointment-warning') %></p>
  </div>
<% end %>

<div id='before-submit-modal-option-container'>
  <%= button_tag 'OpenMODAL', type: 'button', data: { :'micromodal-trigger' => 'test-modal' } %>
  <div class='modal micromodal-slide' id='test-modal' aria-hidden='true'>
    <div class='modal__overlay' tabindex='-1' data-micromodal-close>
      <div class='modal__container test-modal-container' role='dialog' aria-modal='true' aria-labelledby='test-modal-title'>
        <header class='modal__header'>
          <h2 class="modal__title" id="test-modal-title"></h2>
          <button class='modal__close' aria-label='Close modal' data-micromodal-close></button>
        </header>
        TEST TEST
      </div>
    </div>
</div>


<%= render 'jap_agendas_data_modal' %>
<%= javascript_pack_tag 'appointment', 'data-turbolinks-eval': false, defer: true %>
