<% if @organization_divestments.present? %>
<div class="fr-grid-row fr-grid-row--left fr-grid-row--middle fr-grid-row--gutters">

    <h3 class="fr-mr-2w">Demandes de dessaisissement sortant</h3>

</div>
<div class="fr-grid-row fr-grid-row--left fr-grid-row--center fr-grid-row--gutters">
  <div class="col">
    <div class="fr-table fr-table--bordered fr-table--layout-fixed">
      <table>
        <thead>
          <tr>
            <th scope="col"><%= t('activerecord.models.convict', count: 1) %></th>
            <th scope="col">Date</th>
            <th scope="col">Source</th>
            <th scope="col">Services</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @organization_divestments.each do |organization_divestment| %>
            <tr>
              <td>
                <% if policy(organization_divestment.convict).show? %>
                    <%= link_to organization_divestment.convict.name, convict_path(organization_divestment.convict), class: 'index-control', data: { turbo: false } %>
                <% else %>
                    <%= organization_divestment.convict.name %>
                <% end %>
              </td>
              <td><%= organization_divestment.created_at.strftime("%d/%m/%Y") %></td>
              <td><%= organization_divestment.source.name %></td>
              <td>
                <% organization_divestment.other_organizations_divestments.each do |other_organizations_divestment| %>
                  <% badge_class = case other_organizations_divestment.state
                                  when "accepted", "auto_accepted" then "fr-badge--success"
                                  when "ignored" then "fr-badge--new"
                                  when "refused" then "fr-badge--error"
                                  else ""
                                  end %>
                  <p class="fr-badge fr-badge--no-icon <%= badge_class %>"><%= other_organizations_divestment.orga_name %></p>
                <% end %>
              </td>
              <td>
                <% if policy(organization_divestment).validate? %>
                  can be validated
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<%= paginate @organization_divestments %>
<% end %>
<% if @divestments.present? %>
<div class="fr-grid-row fr-grid-row--left fr-grid-row--middle fr-grid-row--gutters">
    <h3 class="fr-mr-2w">Demandes de dessaisissement entrant</h3>
</div>
<div class="col">
  <div class="fr-table fr-table--bordered fr-table--layout-fixed">
    <table>
      <thead>
        <tr>
          <th scope="col"><%= t('activerecord.models.convict', count: 1) %></th>
          <th scope="col">Date</th>
          <th scope="col">Services</th>
        </tr>
      </thead>
      <tbody>
        <% @divestments.each do |divestment| %>
          <tr>
            <td>
              <% if policy(divestment.convict).show? %>
                  <%= link_to divestment.convict.name, convict_path(divestment.convict), class: 'index-control', data: { turbo: false } %>
              <% else %>
                  <%= divestment.convict.name %>
              <% end %>
            </td>
            <td><%= divestment.created_at.strftime("%d/%m/%Y") %></td>
            <td>
              <% divestment.organization_divestments.each do |organizations_divestment| %>
                <% badge_class = case organizations_divestment.state
                                when "accepted", "auto_accepted" then "fr-badge--success"
                                when "ignored" then "fr-badge--new"
                                when "refused" then "fr-badge--error"
                                else ""
                                end %>
                <p class="fr-badge fr-badge--no-icon <%= badge_class %>"><%= organizations_divestment.orga_name %></p>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<%= paginate @divestments %>
<% end %>