<%= link_to t('index_slot_types_back_link', place: @agenda.place.name), edit_place_path(@agenda.place), class: 'index-slot-types-back-button' %>

<h1 class='index-slot-types-title'><%= t('index_slot_types_title') %></h1>
<h2 class='index-slot-types-title-place'><%= t('index_slot_types_title_place', place: @agenda.place.name, agenda: @agenda.name) %></h2>
<p class='index-slot-types-warning'><%= t('index_slot_types_warning') %></p>

<div class='slot-type-apt-type-link-container'>
  <% @agenda.place.appointment_types.each do |apt_type| %>
    <%= link_to apt_type.name, agenda_slot_types_path(@agenda, appointment_type_id: apt_type.id), class: "slot-type-apt-type-link-#{apt_type == @appointment_type}" %>
  <% end %>
</div>

<% if @appointment_type %>
  <div class='slot-type-appointment-type-container'>
    <% SlotType.week_days.keys.each do |weekday| %>
      <h3 class='slot-type-weekday'><%= t("simple_form.options.slot_type.week_day.#{weekday}") %></h3>
      <div class='index-slot-types-weekday-container'>
        <% @slot_types.where(week_day: weekday).each do |slot_type| %>
          <%= simple_form_for slot_type, html: { class: 'slot-type-form' } do |f| %>
            <%= f.hidden_field :agenda_id, value: @agenda.id %>
            <%= f.hidden_field :appointment_type_id, value: @appointment_type.id %>
            <%= f.hidden_field :week_day, value: weekday %>
            <div class='slot-type-time-input'>
              <%= f.input :starting_time, input_html: { value: f.object.starting_time.to_s, class: 'form-select' },
                                          label_html: { class: 'slot-type-time-input-label' },
                                          wrapper: :custom_time,
                                          start_hour: 7,
                                          end_hour: 20,
                                          minute_step: 5 %>
            </div>
            <div class='slot-type-duration-input'><%= f.input :duration %></div>
            <div class='slot-type-capacity-input'><%= f.input :capacity %></div>
            <div class='slot-type-input-last'>
              <%= f.button :submit, t('index_slot_types_update'), class: 'slot-type-submit-button' %>
              <%= link_to t('index_slot_types_delete'), slot_type_path(slot_type),
                                                        method: :delete,
                                                        data: { confirm: t('basic_confirmation') } %>
            </div>
          <% end %>
        <% end %>

        <%= simple_form_for @slot_type, html: { class: 'slot-type-form new-slot-type-form' } do |f| %>
          <%= f.hidden_field :agenda_id, value: @agenda.id %>
          <%= f.hidden_field :appointment_type_id, value: @appointment_type.id %>
          <%= f.hidden_field :week_day, value: weekday %>
          <div class='slot-type-time-input'>
            <%= f.input :starting_time, wrapper: :custom_time,
                                        include_blank: true,
                                        input_html: { class: 'form-select' },
                                        label_html: { class: 'slot-type-time-input-label' },
                                        start_hour: 7,
                                        end_hour: 20,
                                        minute_step: 5 %>
          </div>
          <div class='slot-type-duration-input'><%= f.input :duration, input_html: { value: nil } %></div>
          <div class='slot-type-capacity-input'><%= f.input :capacity, input_html: { value: nil } %></div>
          <div class='slot-type-input-last'>
            <%= f.button :submit, t('index_slot_types_create'), class: 'slot-type-add-button' %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
